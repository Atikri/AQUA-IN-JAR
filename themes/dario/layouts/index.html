{{- define "main" }}
    {{- with .Site.GetPage "_index.md" }}
        {{- if .Params.homePageIsPost }}
    <h1>{{ .Title }}</h1>
    <h4>{{ .Params.description }}</h4>
    <p class="author-date"><time datetime="{{ .Date }}">{{ .Date.Format "January 2, 2006" }}</time> - {{ .Params.author }}</p>

            {{- if not (.Param "disableAnchoredHeadings") }}

{{ partial "anchored_headings.html" .Content }}

            {{- else }}

{{ .Content }}

            {{- end }}
        {{- else }}
            {{- $subtitle := .Params.subtitle }}
            {{- with .Content }}
    <section>
    <h1 class="smaller">{{ $subtitle | emojify }}</h1>
{{ . }}
    </section>
            {{- end }}
        {{- end }}
    {{- end }}

    <!-- Search Section -->
    <section id="search-section" class="search-section">
        <h2>{{ "Search Articles :turtle:" | emojify }}</h2>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="输入关键词搜索..." class="search-input">
            <div id="searchResults" class="search-results"></div>
        </div>
    </section>

    <!-- Categories Section -->
    <section id="categories-section" class="categories-section">
        <h2>分类浏览</h2>
        <div class="categories-grid">
            <div class="category-card">
                <h3><a href="{{ "notification-jar/" | relURL }}">📢 Notification Jar</a></h3>
                <p>通知罐子 - 记录重要的通知和提醒</p>
            </div>
            <div class="category-card">
                <h3><a href="{{ "aquas-field/" | relURL }}">🌾 Aqua's Field</a></h3>
                <p>水之田野 - 创意和灵感的源泉</p>
            </div>
            <div class="category-card">
                <h3><a href="{{ "podcast-music/" | relURL }}">🎧 Podcast & Music</a></h3>
                <p>播客与音乐：收录音频节目与乐曲</p>
            </div>
            <div class="category-card">
                <h3><a href="#" onclick="randomArticle()">🎲 Random Aqua</a></h3>
                <p>随机跳转到一篇文章</p>
            </div>
        </div>
    </section>

    {{- range sort (where .Site.Sections "Section" "in" .Site.MainSections) "Weight" }}
    <section>
    <h2>{{ .Title }}</h2>
    <ul>
        {{- range where .Site.RegularPages "Section" .Section }}
        <li><a href="{{ .Permalink }}">{{ .Title }}</a></li>
        {{- end }}
    </ul>
    </section>
    {{- end }}

    <!-- Random Article JavaScript -->
    <script>
        function randomArticle() {
            // 获取所有文章的URL
            const articles = [
                {{- range where .Site.RegularPages "Type" "posts" }}
                "{{ .Permalink }}",
                {{- end }}
                {{- range where .Site.RegularPages "Type" "aquas-field" }}
                "{{ .Permalink }}",
                {{- end }}
                {{- range where .Site.RegularPages "Type" "notification-jar" }}
                "{{ .Permalink }}",
                {{- end }}
                {{- range where .Site.RegularPages "Type" "podcast-music" }}
                "{{ .Permalink }}",
                {{- end }}
            ];
            
            // 过滤掉空值
            const validArticles = articles.filter(url => url && url.trim() !== '');
            
            if (validArticles.length > 0) {
                // 随机选择一个文章
                const randomIndex = Math.floor(Math.random() * validArticles.length);
                const randomUrl = validArticles[randomIndex];
                
                // 跳转到随机文章
                window.location.href = randomUrl;
            } else {
                alert('暂时没有可用的文章');
            }
        }
    </script>
{{- end }}
